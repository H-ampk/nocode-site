<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="../public/css/main.css" />
  <script src="../src/admin/pin.js" defer></script>
  <script>window.addEventListener('DOMContentLoaded',function(){ if(window.AdminAuth) AdminAuth.init({admin:true}); });</script>
</head>
<body>
  <h1>Admin ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
  <div class="menu">
    <a href="../src/editor/editor.html">ğŸ›  ã‚¯ã‚¤ã‚ºç·¨é›†ï¼ˆEditorï¼‰</a>
    <a href="../src/glossary/glossary.html">ğŸ“š ç”¨èªé›†ç®¡ç†ï¼ˆGlossaryï¼‰</a>
    <a href="project_manager.html">âš™ å…¬é–‹è¨­å®šãƒ»ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š</a>
    <a href="bookshelf.html">ğŸ“š ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæœ¬æ£š</a>
    <a href="analysis.html">ğŸ“Š å­¦ç¿’ãƒ‡ãƒ¼ã‚¿åˆ†æï¼ˆAnalysisï¼‰</a>
    <a href="../main.html">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
  </div>

  <section id="quizVersionList" style="margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 8px; max-width: 800px;">
    <h3>ğŸ“¦ ã‚¯ã‚¤ã‚ºãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸€è¦§</h3>
    <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
      ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: <span id="currentProjectId">default</span>
    </p>
    <ul id="versionList" style="list-style: none; padding: 0;">
      <li style="padding: 10px; background: #fff; margin-bottom: 5px; border-radius: 5px;">èª­ã¿è¾¼ã¿ä¸­...</li>
    </ul>
  </section>

  <section id="versionManagerSection" style="margin-top: 30px; padding: 20px; background: #f9f9f9; border-radius: 8px; max-width: 1000px;">
    <h2>ğŸ“¦ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†</h2>
    <iframe src="version_manager.html" style="width:100%; height:600px; border:1px solid #ddd; border-radius: 8px;"></iframe>
  </section>

  <script>
    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDã‚’å–å¾—
    function getCurrentProjectId() {
      try {
        return localStorage.getItem('projectId') || 'default';
      } catch (e) {
        return 'default';
      }
    }

    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€
    async function loadVersionList() {
      const projectId = getCurrentProjectId();
      document.getElementById('currentProjectId').textContent = projectId;
      
      const ul = document.getElementById('versionList');
      ul.innerHTML = '<li style="padding: 10px; background: #fff; margin-bottom: 5px; border-radius: 5px;">èª­ã¿è¾¼ã¿ä¸­...</li>';
      
      try {
        // æ³¨æ„: ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ç›´æ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä¸€è¦§ã‚’å–å¾—ã™ã‚‹ã“ã¨ã¯ã§ããªã„ãŸã‚ã€
        // å®Ÿéš›ã®é‹ç”¨ã§ã¯ã‚µãƒ¼ãƒãƒ¼å´APIãŒå¿…è¦ã§ã™
        // ã“ã“ã§ã¯ quiz.json ã®å­˜åœ¨ç¢ºèªã¨ã€localStorage ã«ä¿å­˜ã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ã‚’è¡¨ç¤º
        const quizPath = `../projects/${projectId}/quiz.json`;
        const response = await fetch(quizPath);
        
        if (response.ok) {
          const quiz = await response.json();
          ul.innerHTML = '';
          
          // quiz.json ã®æƒ…å ±ã‚’è¡¨ç¤º
          const li = document.createElement('li');
          li.style.cssText = 'padding: 10px; background: #fff; margin-bottom: 5px; border-radius: 5px; border-left: 4px solid #2d7bf4;';
          li.innerHTML = `
            <strong>quiz.json</strong> (ç¾åœ¨ã®ã‚¯ã‚¤ã‚º)<br>
            <small style="color: #666;">
              ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${quiz.version || 'N/A'}<br>
              ä½œæˆæ—¥æ™‚: ${quiz.version_date ? new Date(quiz.version_date).toLocaleString('ja-JP') : 'N/A'}<br>
              ä½œæˆè€…: ${quiz.author || 'N/A'}
            </small>
          `;
          ul.appendChild(li);
          
          // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³å±¥æ­´ã‚’å–å¾—ï¼ˆã‚ã‚Œã°ï¼‰
          try {
            const history = JSON.parse(localStorage.getItem(`quiz_versions_${projectId}`) || '[]');
            if (history.length > 0) {
              const historyTitle = document.createElement('li');
              historyTitle.style.cssText = 'padding: 10px; background: #e8f4f8; margin-top: 15px; margin-bottom: 5px; border-radius: 5px; font-weight: bold;';
              historyTitle.textContent = 'ä¿å­˜å±¥æ­´ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰';
              ul.appendChild(historyTitle);
              
              history.slice(0, 10).forEach(function(version) {
                const historyLi = document.createElement('li');
                historyLi.style.cssText = 'padding: 10px; background: #fff; margin-bottom: 5px; border-radius: 5px;';
                historyLi.innerHTML = `
                  <strong>${version.filename}</strong><br>
                  <small style="color: #666;">${version.date ? new Date(version.date).toLocaleString('ja-JP') : 'N/A'}</small>
                `;
                ul.appendChild(historyLi);
              });
            }
          } catch (e) {
            console.warn('Failed to load version history:', e);
          }
        } else {
          ul.innerHTML = '<li style="padding: 10px; background: #fff; margin-bottom: 5px; border-radius: 5px; color: #999;">ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</li>';
        }
      } catch (error) {
        console.error('Failed to load version list:', error);
        ul.innerHTML = '<li style="padding: 10px; background: #fff; margin-bottom: 5px; border-radius: 5px; color: #e53e3e;">ã‚¨ãƒ©ãƒ¼: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</li>';
      }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
    window.addEventListener('DOMContentLoaded', loadVersionList);
  </script>
</body>
</html>


