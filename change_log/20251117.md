# 2025-11-17 プロジェクト再構成・公開方式・admin分離 変更履歴

## 重要変更（破壊的）
- ルート直下のHTML/JSを役割別フォルダへ強制移動（元ファイルは削除）。ルート直下は `main.html / README.md / package.json / LICENSE / .gitignore` のみ。
- エントリーポイントを `main.html` に統一（トップページ）。

## ディレクトリ再編
- 新規作成/整理
  - `src/`（ロジック本体）: `core/`, `editor/`, `player/`, `glossary/`, `concepts/`, `diagnostic/`, `explanation/`, `utils/`, `auth/`
  - `public/`（静的ファイル）: `public/css/`, `public/img/`
  - `player/`（一般利用画面）: `player/index.html`, `player/demo.html`
  - `admin/`（管理画面）: `admin/admin.html`, `admin/editor.html`, `admin/glossary.html`, `admin/project_manager.html`, `admin/login.html`
  - `projects/`（ユーザープロジェクト）: `projects/sample_project/`（`quiz.json`, `editor.json`, `glossary.json`, `concept_graph.json`, `project.json`）
  - `docs/`（ドキュメント）: `README.md`, `architecture.md`, `roadmap.md`, `glossary_spec.md`, `concept_graph_spec.md`, `diagnostic_logic.md`, `README_legacy.html`
  - `archive/`（一時退避）: `archive/README.md`

## 公開方式（public/pin/login）導入
- `projects/{id}/project.json` に公開方式を保存:
  - `access_mode`: `"public" | "pin" | "login"`（初期値 `"public"`）
  - `pin_code`: `"1234"` など（`pin` 以外では `null`）
- サンプル `projects/sample_project/project.json` を `{"access_mode":"public","pin_code":null}` に修正。

## 管理画面のPIN認証
- 追加: `src/auth/pin.js`（`window.AdminAuth.init({admin:true})`）
- `admin/*` はPINロジックを必ず読み込み。挙動:
  - `public`: 認証不要
  - `pin`: `project.json.pin_code` 一致時に `localStorage` に認証フラグ保存
  - `login`: 未実装メッセージを表示してアクセス不可（将来対応）

## エントリ/UI
- `main.html` を入口に統一。メニュー: Player・Admin・Projects。
- 公開設定UI（main / admin 両方）
  - ラジオ: `public`（初期選択）/`pin`/`login`（将来機能）
  - `pin` 選択時のみPIN入力欄を表示
  - `project.json` の読み込み/ダウンロード保存を実装
- 共通設定ユーティリティ: `src/core/config.js`（`window.ProjectConfig.load/download/normalize`）

## プレイヤー/エディタ
- `player/index.html`（一般公開画面）を整備。デモ遷移先を `player/demo.html` に変更。
- `player/demo.html` を新設し、ルートの `demo.html` は削除。
- エディタは `admin/editor.html`（iframeで `src/editor/editor.html` を埋め込み）へ一本化。
- `src/editor/editor.js` は当面レガシー互換ローダ（将来本体移設予定）。

## 静的ファイル
- CSSを `public/css/main.css` に統一。各HTMLの `<link>` を更新。
- 画像は今後 `public/img/` へ集約（段階移行方針を `public/README.md` に記載）。

## ドキュメント更新
- `README.md` に新ディレクトリ構成・公開方式・PIN仕様・利用手順・ユーティリティを追記。
- 旧 `README.html` は `docs/README_legacy.html` へ移動。

## ルートから削除（移動後）
- `editor.html`, `glossary.html`, `player.html`, `login.html`, `demo.html`, `README.html`, `auth.js`

## 備考 / 今後のタスク
- `data/` 配下の画像/音源は段階的に `public/img/` へ移行し、参照パスを置換予定。
- `src/editor/editor.js` の本体移設（ローダ脱却）を継続。


